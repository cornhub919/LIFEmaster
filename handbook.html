<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeMasteræ‰‹è´¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5e3b12',
                        secondary: '#e8d8c3',
                        accent: '#f5e8d0',
                        light: '#f5f0e1',
                        dark: '#4a2f0e',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                        custom: ['HuXiaoBoNanShenTi', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                @apply hover:shadow-lg hover:-translate-y-1 transition-all duration-300;
            }
            .btn-primary {
                @apply bg-primary text-white py-2 px-4 rounded-lg shadow-md hover:bg-dark transition-all duration-300;
            }
            .btn-secondary {
                @apply bg-white text-primary border border-primary py-2 px-4 rounded-lg shadow-sm hover:bg-secondary transition-all duration-300;
            }
            .input-field {
                @apply border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-200;
            }
        }
    </style>
    <style>
        /* ä¿æŒåŸæœ‰CSSé£æ ¼ */
        .handbook-container {
            display: flex;
            height: 100vh;
            background-color: #f5f0e1; /* æµ…æ£•è‰²èƒŒæ™¯ */
            margin: 0;
        }
        
        .sidebar {
            width: 250px; /* å›ºå®šå®½åº¦ */
            background-color: #f5e8d0; /* ç±³è‰²èƒŒæ™¯ */
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); /* æ·»åŠ é˜´å½± */
        }
        
        .sidebar h1 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #5e3b12; /* æ£•è‰²æ–‡å­— */
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .menu li {
            font-size: 1.2rem;
            color: #5e3b12; /* æ£•è‰²æ–‡å­— */
            padding: 0.5rem 0;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .menu li:hover {
            background-color: #e8d8c3; /* æ‚¬åœæ•ˆæœ */
            border-radius: 5px;
        }
        
        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .sidebar .btn {
            background-color: #5e3b12; /* æ£•è‰²èƒŒæ™¯ */
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }
        
        .sidebar .btn:hover {
            background-color: #4a2f0e; /* æ·±æ£•è‰²æ‚¬åœæ•ˆæœ */
        }
        
        .content {
            flex: 1;
            background-color: #f5f0e1; /* æµ…æ£•è‰²èƒŒæ™¯ */
            padding: 1rem;
            overflow-y: auto;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* è‡ªé€‚åº”ä¸¤åˆ—å¸ƒå±€ */
            gap: 1rem;
        }
        
        .card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* æ·»åŠ é˜´å½± */
            padding: 1rem;
            position: relative;
            text-align: center;
            font-family: 'HuXiaoBoNanShenTi', sans-serif; /* ä½¿ç”¨èƒ¡æ™“æ³¢ç”·ç¥ä½“ */
            font-size: 1.2rem;
            color: #5e3b12; /* æ£•è‰²æ–‡å­— */
            font-weight: bold;
        }
        
        .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #ccc; /* ç°è‰²èƒŒæ™¯ */
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .delete-btn:hover {
            background-color: #999; /* æ·±ç°è‰²æ‚¬åœæ•ˆæœ */
        }
        
        .card p {
            margin: 1.5rem 0 0 0;
            word-wrap: break-word; /* é˜²æ­¢æ–‡å­—é‡å  */
        }
        
        /* æ–°å¢çš„è‡ªå®šä¹‰æ ·å¼ */
        .handbook-editor {
            min-height: 300px;
            border: 1px dashed #ccc;
            background-color: white;
            padding: 1rem;
            position: relative;
        }
        
        .sticker {
            position: absolute;
            cursor: move;
            user-select: none;
        }
        
        .text-box {
            position: absolute;
            border: 1px solid transparent;
            min-width: 100px;
            min-height: 40px;
            padding: 0.5rem;
            cursor: move;
            user-select: none;
        }
        
        .text-box:focus {
            border: 1px dashed #5e3b12;
            outline: none;
        }
        
        .image-container {
            position: absolute;
            cursor: move;
        }
        
        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #5e3b12;
            border-radius: 50%;
            display: none;
        }
        
        .resize-handle-se {
            bottom: -5px;
            right: -5px;
            cursor: se-resize;
        }
        
        .resize-handle-ne {
            top: -5px;
            right: -5px;
            cursor: ne-resize;
        }
        
        .resize-handle-sw {
            bottom: -5px;
            left: -5px;
            cursor: sw-resize;
        }
        
        .resize-handle-nw {
            top: -5px;
            left: -5px;
            cursor: nw-resize;
        }
        
        .element-selected .resize-handle {
            display: block;
        }
        
        .editor-toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .editor-toolbar button {
            background-color: white;
            border: 1px solid #5e3b12;
            color: #5e3b12;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .editor-toolbar button:hover {
            background-color: #e8d8c3;
        }
    </style>
</head>
<body>
    <div class="handbook-container">
        <!-- å·¦ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <h1>LifeMasteræ‰‹è´¦</h1>
            <ul class="menu">
                <li>æ‰€æœ‰æ–‡ä»¶</li>
                <li>æ—…è¡Œæ‰‹è´¦</li>
                <li>æ—¥å¸¸å‡ºæ¸¸</li>
            </ul>
            <div class="sidebar-buttons">
                <button class="btn" id="new-folder-btn">æ–°å»ºæ–‡ä»¶å¤¹</button>
                <button class="btn" id="new-file-btn">æ–°å»ºæ–‡ä»¶</button>
            </div>
        </aside>

        <!-- å³ä¾§ä¸»å†…å®¹åŒº
        <main class="content">
            <div class="grid">
                <div class="card">
                    <div class="delete-btn">X</div>
                    <p>æ–°å»ºæ–‡ä»¶</p>
                </div>
            </div>
        </main>
    </div> -->
    
    <!-- æ–°å»ºæ–‡ä»¶å¤¹æ¨¡æ€æ¡† -->
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="new-folder-modal">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-primary">æ–°å»ºæ–‡ä»¶å¤¹</h3>
                <button class="text-gray-500 hover:text-gray-700" id="close-folder-modal">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">æ–‡ä»¶å¤¹åç§°</label>
                <input type="text" class="input-field w-full" id="folder-name-input" placeholder="è¾“å…¥æ–‡ä»¶å¤¹åç§°">
            </div>
            <div class="flex justify-end space-x-3">
                <button class="btn-secondary" id="cancel-folder-btn">å–æ¶ˆ</button>
                <button class="btn-primary" id="confirm-folder-btn">åˆ›å»º</button>
            </div>
        </div>
    </div>
    
    <!-- æ–°å»ºæ–‡ä»¶æ¨¡æ€æ¡† -->
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="new-file-modal">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-primary">æ–°å»ºæ‰‹è´¦</h3>
                <button class="text-gray-500 hover:text-gray-700" id="close-file-modal">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">æ‰‹è´¦æ ‡é¢˜</label>
                <input type="text" class="input-field w-full" id="file-title-input" placeholder="è¾“å…¥æ‰‹è´¦æ ‡é¢˜">
            </div>
            
            <!-- ç¼–è¾‘å™¨å·¥å…·æ  -->
            <div class="editor-toolbar">
                <button id="add-image-btn" title="æ’å…¥å›¾ç‰‡">
                    <i class="fa fa-picture-o"></i>
                </button>
                <button id="add-sticker-btn" title="æ’å…¥è´´çº¸">
                    <i class="fa fa-smile-o"></i>
                </button>
                <button id="add-text-btn" title="æ’å…¥æ–‡æœ¬æ¡†">
                    <i class="fa fa-font"></i>
                </button>
                <div class="ml-auto">
                    <select id="sticker-select" class="border border-gray-300 rounded-lg px-2 py-1">
                        <option value="">é€‰æ‹©è´´çº¸...</option>
                        <option value="heart">â¤ï¸</option>
                        <option value="star">â­</option>
                        <option value="smile">ğŸ˜Š</option>
                        <option value="flower">ğŸŒ¸</option>
                        <option value="sun">â˜€ï¸</option>
                    </select>
                </div>
            </div>
            
            <!-- æ‰‹è´¦ç¼–è¾‘å™¨ -->
            <div class="handbook-editor mb-4" id="handbook-editor">
                <!-- è¿™é‡Œæ˜¯ç”¨æˆ·å¯ä»¥æ‹–æ”¾å†…å®¹çš„åŒºåŸŸ -->
                <div class="text-center text-gray-400 mt-10">
                    <p>æ‹–æ”¾å›¾ç‰‡ã€è´´çº¸æˆ–æ–‡æœ¬æ¡†åˆ°è¿™é‡Œ</p>
                    <p class="text-sm mt-2">ä½¿ç”¨å·¥å…·æ æ·»åŠ å…ƒç´ </p>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button class="btn-secondary" id="cancel-file-btn">å–æ¶ˆ</button>
                <button class="btn-primary" id="confirm-file-btn">ä¿å­˜æ‰‹è´¦</button>
            </div>
        </div>
    </div>
    
    <!-- å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="image-upload-modal">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-primary">ä¸Šä¼ å›¾ç‰‡</h3>
                <button class="text-gray-500 hover:text-gray-700" id="close-image-modal">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©å›¾ç‰‡</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                    <input type="file" class="hidden" id="image-upload-input">
                    <button class="btn-primary" id="browse-image-btn">æµè§ˆæ–‡ä»¶</button>
                    <p class="text-sm text-gray-500 mt-2">æ”¯æŒJPG, PNG, GIFæ ¼å¼</p>
                    <div class="mt-4 hidden" id="image-preview-container">
                        <img src="" alt="é¢„è§ˆå›¾" class="max-w-full h-auto rounded-lg" id="image-preview">
                    </div>
                </div>
            </div>
            <div class="flex justify-end space-x-3">
                <button class="btn-secondary" id="cancel-image-btn">å–æ¶ˆ</button>
                <button class="btn-primary" id="confirm-image-btn" disabled>æ’å…¥å›¾ç‰‡</button>
            </div>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ 
        const newFolderBtn = document.getElementById('new-folder-btn');
        const newFileBtn = document.getElementById('new-file-btn');
        const closeFolderModal = document.getElementById('close-folder-modal');
        const cancelFolderBtn = document.getElementById('cancel-folder-btn');
        const confirmFolderBtn = document.getElementById('confirm-folder-btn');
        const folderNameInput = document.getElementById('folder-name-input');
        const newFolderModal = document.getElementById('new-folder-modal');
        
        const closeFileModal = document.getElementById('close-file-modal');
        const cancelFileBtn = document.getElementById('cancel-file-btn');
        const confirmFileBtn = document.getElementById('confirm-file-btn');
        const fileTitleInput = document.getElementById('file-title-input');
        const newFileModal = document.getElementById('new-file-modal');
        
        const handbookEditor = document.getElementById('handbook-editor');
        const addImageBtn = document.getElementById('add-image-btn');
        const addStickerBtn = document.getElementById('add-sticker-btn');
        const addTextBtn = document.getElementById('add-text-btn');
        const stickerSelect = document.getElementById('sticker-select');
        
        const imageUploadModal = document.getElementById('image-upload-modal');
        const closeImageModal = document.getElementById('close-image-modal');
        const cancelImageBtn = document.getElementById('cancel-image-btn');
        const confirmImageBtn = document.getElementById('confirm-image-btn');
        const browseImageBtn = document.getElementById('browse-image-btn');
        const imageUploadInput = document.getElementById('image-upload-input');
        const imagePreview = document.getElementById('image-preview');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        
        // å½“å‰é€‰ä¸­çš„å…ƒç´ 
        let selectedElement = null;
        let isDragging = false;
        let offsetX, offsetY;
        let currentAction = null; // 'resize' æˆ– 'move'
        let resizeDirection = null; // 'se', 'ne', 'sw', 'nw'
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°
            bindEvents();
        });
        
        // ç»‘å®šæ‰€æœ‰äº‹ä»¶å¤„ç†å‡½æ•°
        function bindEvents() {
            // ä¾§è¾¹æ æŒ‰é’®äº‹ä»¶
            newFolderBtn.addEventListener('click', openNewFolderModal);
            newFileBtn.addEventListener('click', openNewFileModal);
            
            // æ–‡ä»¶å¤¹æ¨¡æ€æ¡†äº‹ä»¶
            closeFolderModal.addEventListener('click', closeNewFolderModal);
            cancelFolderBtn.addEventListener('click', closeNewFolderModal);
            confirmFolderBtn.addEventListener('click', createNewFolder);
            
            // æ–‡ä»¶æ¨¡æ€æ¡†äº‹ä»¶
            closeFileModal.addEventListener('click', closeNewFileModal);
            cancelFileBtn.addEventListener('click', closeNewFileModal);
            confirmFileBtn.addEventListener('click', createNewFile);
            
            // ç¼–è¾‘å™¨å·¥å…·æ äº‹ä»¶
            addImageBtn.addEventListener('click', openImageUploadModal);
            addStickerBtn.addEventListener('click', addSticker);
            addTextBtn.addEventListener('click', addTextBox);
            stickerSelect.addEventListener('change', function() {
                if (this.value) {
                    addSticker(this.value);
                    this.value = '';
                }
            });
            
            // å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†äº‹ä»¶
            closeImageModal.addEventListener('click', closeImageUploadModal);
            cancelImageBtn.addEventListener('click', closeImageUploadModal);
            confirmImageBtn.addEventListener('click', insertImage);
            browseImageBtn.addEventListener('click', function() {
                imageUploadInput.click();
            });
            
            imageUploadInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        imagePreview.src = event.target.result;
                        imagePreviewContainer.classList.remove('hidden');
                        confirmImageBtn.disabled = false;
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            // ç¼–è¾‘å™¨äº¤äº’äº‹ä»¶
            handbookEditor.addEventListener('mousedown', handleEditorMouseDown);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }
        
        // æ‰“å¼€æ–°å»ºæ–‡ä»¶å¤¹æ¨¡æ€æ¡†
        function openNewFolderModal() {
            newFolderModal.classList.remove('hidden');
            folderNameInput.focus();
        }
        
        // å…³é—­æ–°å»ºæ–‡ä»¶å¤¹æ¨¡æ€æ¡†
        function closeNewFolderModal() {
            newFolderModal.classList.add('hidden');
            folderNameInput.value = '';
        }
        
        // è·å–èœå•åˆ—è¡¨å…ƒç´ 
        const menuList = document.querySelector('.menu');

        // åˆ›å»ºæ–°æ–‡ä»¶å¤¹
        function createNewFolder() {
            const folderName = folderNameInput.value.trim();
            if (folderName) {
                // æ–°å¢ï¼šåœ¨å·¦ä¾§èœå•æ æ·»åŠ æ–°æ–‡ä»¶å¤¹
                const li = document.createElement('li');
                li.textContent = folderName;
                li.style.fontSize = '1.2rem';
                li.style.color = '#5e3b12';
                li.style.padding = '0.5rem 0';
                li.style.textAlign = 'center';
                li.style.cursor = 'pointer';
                li.addEventListener('mouseenter', () => li.style.backgroundColor = '#e8d8c3');
                li.addEventListener('mouseleave', () => li.style.backgroundColor = '');
                menuList.appendChild(li);

                closeNewFolderModal();
            } else {
                alert('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°');
            }
        }
        
        // æ‰“å¼€æ–°å»ºæ–‡ä»¶æ¨¡æ€æ¡†
        function openNewFileModal() {
            newFileModal.classList.remove('hidden');
            fileTitleInput.focus();
            // æ¸…ç©ºç¼–è¾‘å™¨
            handbookEditor.innerHTML = `
                <div class="text-center text-gray-400 mt-10">
                    <p>æ‹–æ”¾å›¾ç‰‡ã€è´´çº¸æˆ–æ–‡æœ¬æ¡†åˆ°è¿™é‡Œ</p>
                    <p class="text-sm mt-2">ä½¿ç”¨å·¥å…·æ æ·»åŠ å…ƒç´ </p>
                </div>
            `;
        }
        
        // å…³é—­æ–°å»ºæ–‡ä»¶æ¨¡æ€æ¡†
        function closeNewFileModal() {
            newFileModal.classList.add('hidden');
            fileTitleInput.value = '';
        }
        
        // æ‰“å¼€å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†
        function openImageUploadModal() {
            imageUploadModal.classList.remove('hidden');
            imageUploadInput.value = '';
            imagePreviewContainer.classList.add('hidden');
            confirmImageBtn.disabled = true;
        }
        
        // å…³é—­å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†
        function closeImageUploadModal() {
            imageUploadModal.classList.add('hidden');
        }
        
        // æ’å…¥å›¾ç‰‡åˆ°ç¼–è¾‘å™¨
        function insertImage() {
            if (imagePreview.src) {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'image-container';
                imgContainer.style.position = 'absolute';
                imgContainer.style.top = '50px';
                imgContainer.style.left = '50px';
                
                const img = document.createElement('img');
                img.src = imagePreview.src;
                img.style.maxWidth = '200px';
                img.style.height = 'auto';
                
                // æ·»åŠ è°ƒæ•´å¤§å°æ‰‹æŸ„
                const resizeSE = document.createElement('div');
                resizeSE.className = 'resize-handle resize-handle-se';
                
                const resizeNE = document.createElement('div');
                resizeNE.className = 'resize-handle resize-handle-ne';
                
                const resizeSW = document.createElement('div');
                resizeSW.className = 'resize-handle resize-handle-sw';
                
                const resizeNW = document.createElement('div');
                resizeNW.className = 'resize-handle resize-handle-nw';
                
                imgContainer.appendChild(img);
                imgContainer.appendChild(resizeSE);
                imgContainer.appendChild(resizeNE);
                imgContainer.appendChild(resizeSW);
                imgContainer.appendChild(resizeNW);
                
                // æ¸…ç©ºç¼–è¾‘å™¨æç¤ºæ–‡æœ¬
                if (handbookEditor.querySelector('.text-center')) {
                    handbookEditor.innerHTML = '';
                }
                
                handbookEditor.appendChild(imgContainer);
                
                // ç»‘å®šäº‹ä»¶
                bindElementEvents(imgContainer);
                
                closeImageUploadModal();
            }
        }
        
        // æ·»åŠ è´´çº¸
        function addSticker(stickerType = 'heart') {
            const stickers = {
                heart: 'â¤ï¸',
                star: 'â­',
                smile: 'ğŸ˜Š',
                flower: 'ğŸŒ¸',
                sun: 'â˜€ï¸'
            };
            
            const sticker = document.createElement('div');
            sticker.className = 'sticker';
            sticker.style.position = 'absolute';
            sticker.style.top = '50px';
            sticker.style.left = '50px';
            sticker.style.fontSize = '2rem';
            sticker.textContent = stickers[stickerType] || stickers.heart;
            
            // æ·»åŠ è°ƒæ•´å¤§å°æ‰‹æŸ„
            const resizeSE = document.createElement('div');
            resizeSE.className = 'resize-handle resize-handle-se';
            
            sticker.appendChild(resizeSE);
            
            // æ¸…ç©ºç¼–è¾‘å™¨æç¤ºæ–‡æœ¬
            if (handbookEditor.querySelector('.text-center')) {
                handbookEditor.innerHTML = '';
            }
            
            handbookEditor.appendChild(sticker);
            
            // ç»‘å®šäº‹ä»¶
            bindElementEvents(sticker);
        }
        
        // æ·»åŠ æ–‡æœ¬æ¡†
        function addTextBox() {
            const textBox = document.createElement('div');
            textBox.className = 'text-box';
            textBox.style.position = 'absolute';
            textBox.style.top = '50px';
            textBox.style.left = '50px';
            textBox.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
            textBox.style.borderRadius = '5px';
            textBox.style.padding = '0.5rem';
            textBox.style.minWidth = '150px';
            textBox.setAttribute('contenteditable', 'true');
            textBox.textContent = 'è¾“å…¥æ–‡æœ¬...';
            
            // æ·»åŠ è°ƒæ•´å¤§å°æ‰‹æŸ„
            const resizeSE = document.createElement('div');
            resizeSE.className = 'resize-handle resize-handle-se';
            
            textBox.appendChild(resizeSE);
            
            // æ¸…ç©ºç¼–è¾‘å™¨æç¤ºæ–‡æœ¬
            if (handbookEditor.querySelector('.text-center')) {
                handbookEditor.innerHTML = '';
            }
            
            handbookEditor.appendChild(textBox);
            
            // ç»‘å®šäº‹ä»¶
            bindElementEvents(textBox);
            
            // è‡ªåŠ¨èšç„¦
            textBox.focus();
        }
        
        // ç»‘å®šå…ƒç´ äº‹ä»¶
        function bindElementEvents(element) {
            element.addEventListener('mousedown', function(e) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯è°ƒæ•´å¤§å°æ‰‹æŸ„
                if (e.target.classList.contains('resize-handle')) {
                    currentAction = 'resize';
                    
                    if (e.target.classList.contains('resize-handle-se')) {
                        resizeDirection = 'se';
                    } else if (e.target.classList.contains('resize-handle-ne')) {
                        resizeDirection = 'ne';
                    } else if (e.target.classList.contains('resize-handle-sw')) {
                        resizeDirection = 'sw';
                    } else if (e.target.classList.contains('resize-handle-nw')) {
                        resizeDirection = 'nw';
                    }
                    
                    selectedElement = element;
                    isDragging = true;
                    
                    // é˜²æ­¢é€‰ä¸­å…¶ä»–æ–‡æœ¬
                    e.preventDefault();
                } 
                // å¦‚æœç‚¹å‡»çš„æ˜¯å…ƒç´ æœ¬èº«
                else if (e.target === element || element.contains(e.target)) {
                    // å–æ¶ˆä¹‹å‰é€‰ä¸­çš„å…ƒç´ 
                    if (selectedElement) {
                        selectedElement.classList.remove('element-selected');
                    }
                    
                    // è®¾ç½®å½“å‰é€‰ä¸­å…ƒç´ 
                    selectedElement = element;
                    element.classList.add('element-selected');
                    
                    // è®¡ç®—é¼ æ ‡ç›¸å¯¹å…ƒç´ çš„åç§»é‡
                    const rect = element.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                    
                    currentAction = 'move';
                    isDragging = true;
                    
                    // é˜²æ­¢é€‰ä¸­å…¶ä»–æ–‡æœ¬
                    e.preventDefault();
                }
            });
        }
        
        // å¤„ç†ç¼–è¾‘å™¨é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
        function handleEditorMouseDown(e) {
            // å¦‚æœç‚¹å‡»çš„æ˜¯ç¼–è¾‘å™¨ç©ºç™½å¤„ï¼Œå–æ¶ˆé€‰ä¸­
            if (e.target === handbookEditor) {
                if (selectedElement) {
                    selectedElement.classList.remove('element-selected');
                    selectedElement = null;
                }
            }
        }
        
        // å¤„ç†é¼ æ ‡ç§»åŠ¨äº‹ä»¶
        function handleMouseMove(e) {
            if (!isDragging) return;
            
            if (currentAction === 'move' && selectedElement) {
                // ç§»åŠ¨å…ƒç´ 
                const editorRect = handbookEditor.getBoundingClientRect();
                const newX = e.clientX - editorRect.left - offsetX;
                const newY = e.clientY - editorRect.top - offsetY;
                
                // ç¡®ä¿å…ƒç´ ä¸è¶…å‡ºç¼–è¾‘å™¨è¾¹ç•Œ
                const elementWidth = selectedElement.offsetWidth;
                const elementHeight = selectedElement.offsetHeight;
                
                const maxX = editorRect.width - elementWidth;
                const maxY = editorRect.height - elementHeight;
                
                selectedElement.style.left = Math.max(0, Math.min(newX, maxX)) + 'px';
                selectedElement.style.top = Math.max(0, Math.min(newY, maxY)) + 'px';
            } 
            else if (currentAction === 'resize' && selectedElement) {
                // è°ƒæ•´å…ƒç´ å¤§å°
                const editorRect = handbookEditor.getBoundingClientRect();
                const elementRect = selectedElement.getBoundingClientRect();
                
                let newWidth, newHeight;
                
                if (resizeDirection === 'se') {
                    newWidth = e.clientX - elementRect.left;
                    newHeight = e.clientY - elementRect.top;
                } else if (resizeDirection === 'ne') {
                    newWidth = e.clientX - elementRect.left;
                    newHeight = elementRect.top + elementRect.height - e.clientY;
                    selectedElement.style.top = e.clientY - editorRect.top + 'px';
                } else if (resizeDirection === 'sw') {
                    newWidth = elementRect.right - e.clientX;
                    newHeight = e.clientY - elementRect.top;
                    selectedElement.style.left = e.clientX - editorRect.left + 'px';
                } else if (resizeDirection === 'nw') {
                    newWidth = elementRect.right - e.clientX;
                    newHeight = elementRect.top + elementRect.height - e.clientY;
                    selectedElement.style.left = e.clientX - editorRect.left + 'px';
                    selectedElement.style.top = e.clientY - editorRect.top + 'px';
                }
                
                // ç¡®ä¿æœ€å°å°ºå¯¸
                newWidth = Math.max(50, newWidth);
                newHeight = Math.max(50, newHeight);
                
                // ç¡®ä¿ä¸è¶…å‡ºç¼–è¾‘å™¨è¾¹ç•Œ
                if (elementRect.left + newWidth <= editorRect.width) {
                    if (selectedElement.tagName === 'IMG') {
                        selectedElement.style.width = newWidth + 'px';
                    } else {
                        selectedElement.style.width = newWidth + 'px';
                    }
                }
                
                if (elementRect.top + newHeight <= editorRect.height) {
                    if (selectedElement.classList.contains('sticker')) {
                        // å¯¹äºè´´çº¸ï¼Œè°ƒæ•´å­—ä½“å¤§å°
                        const fontSize = Math.max(12, newHeight / 2);
                        selectedElement.style.fontSize = fontSize + 'px';
                    } else if (selectedElement.tagName === 'IMG') {
                        // å¯¹äºå›¾ç‰‡ï¼Œä¿æŒæ¯”ä¾‹
                        const img = selectedElement.querySelector('img');
                        if (img) {
                            img.style.width = newWidth + 'px';
                            img.style.height = 'auto';
                        }
                    } else {
                        selectedElement.style.height = newHeight + 'px';
                    }
                }
            }
        }
        
        // å¤„ç†é¼ æ ‡é‡Šæ”¾äº‹ä»¶
        function handleMouseUp() {
            isDragging = false;
            currentAction = null;
            resizeDirection = null;
        }
        
        // åˆ›å»ºæ–°æ‰‹è´¦æ–‡ä»¶
        function createNewFile() {
            const title = fileTitleInput.value.trim();
            
            if (title) {
                // è·å–ç¼–è¾‘å™¨å†…å®¹
                const elements = handbookEditor.querySelectorAll('.image-container, .sticker, .text-box');
                const content = [];
                
                elements.forEach(element => {
                    const elementData = {
                        type: element.classList.contains('image-container') ? 'image' : 
                              element.classList.contains('sticker') ? 'sticker' : 'text',
                        top: element.style.top,
                        left: element.style.left,
                        width: element.style.width || element.offsetWidth + 'px',
                        height: element.style.height || element.offsetHeight + 'px'
                    };
                    
                    if (elementData.type === 'image') {
                        const img = element.querySelector('img');
                        elementData.src = img.src;
                    } else if (elementData.type === 'sticker') {
                        elementData.content = element.textContent;
                    } else if (elementData.type === 'text') {
                        elementData.content = element.textContent;
                    }
                    
                    content.push(elementData);
                });
                
                // è¿™é‡Œå¯ä»¥æ·»åŠ ä¿å­˜æ‰‹è´¦çš„é€»è¾‘
                console.log('ä¿å­˜æ‰‹è´¦:', { title, content });
                alert(`æ‰‹è´¦ "${title}" å·²ä¿å­˜`);
                
                closeNewFileModal();
            } else {
                alert('è¯·è¾“å…¥æ‰‹è´¦æ ‡é¢˜');
            }
        }
    </script>
</body>
</html>