<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeMaster手账</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5e3b12',
                        secondary: '#e8d8c3',
                        accent: '#f5e8d0',
                        light: '#f5f0e1',
                        dark: '#4a2f0e',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                        custom: ['HuXiaoBoNanShenTi', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                @apply hover:shadow-lg hover:-translate-y-1 transition-all duration-300;
            }
            .btn-primary {
                @apply bg-primary text-white py-2 px-4 rounded-lg shadow-md hover:bg-dark transition-all duration-300;
            }
            .btn-secondary {
                @apply bg-white text-primary border border-primary py-2 px-4 rounded-lg shadow-sm hover:bg-secondary transition-all duration-300;
            }
            .input-field {
                @apply border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-200;
            }
        }
    </style>
    <style>
        /* 保持原有CSS风格 */
        .handbook-container {
            display: flex;
            height: 100vh;
            background-color: #f5f0e1; /* 浅棕色背景 */
            margin: 0;
        }
        
        .sidebar {
            width: 250px; /* 固定宽度 */
            background-color: #f5e8d0; /* 米色背景 */
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); /* 添加阴影 */
        }
        
        .sidebar h1 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #5e3b12; /* 棕色文字 */
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .menu li {
            font-size: 1.2rem;
            color: #5e3b12; /* 棕色文字 */
            padding: 0.5rem 0;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .menu li:hover {
            background-color: #e8d8c3; /* 悬停效果 */
            border-radius: 5px;
        }
        
        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .sidebar .btn {
            background-color: #5e3b12; /* 棕色背景 */
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }
        
        .sidebar .btn:hover {
            background-color: #4a2f0e; /* 深棕色悬停效果 */
        }
        
        .content {
            flex: 1;
            background-color: #f5f0e1; /* 浅棕色背景 */
            padding: 1rem;
            overflow-y: auto;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* 自适应两列布局 */
            gap: 1rem;
        }
        
        .card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* 添加阴影 */
            padding: 1rem;
            position: relative;
            text-align: center;
            font-family: 'HuXiaoBoNanShenTi', sans-serif; /* 使用胡晓波男神体 */
            font-size: 1.2rem;
            color: #5e3b12; /* 棕色文字 */
            font-weight: bold;
        }
        
        .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #ccc; /* 灰色背景 */
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .delete-btn:hover {
            background-color: #999; /* 深灰色悬停效果 */
        }
        
        .card p {
            margin: 1.5rem 0 0 0;
            word-wrap: break-word; /* 防止文字重叠 */
        }
        
        /* 新增的自定义样式 */
        .handbook-editor {
            min-height: 300px;
            border: 1px dashed #ccc;
            background-color: white;
            padding: 1rem;
            position: relative;
        }
        
        .sticker {
            position: absolute;
            cursor: move;
            user-select: none;
        }
        
        .text-box {
            position: absolute;
            border: 1px solid transparent;
            min-width: 100px;
            min-height: 40px;
            padding: 0.5rem;
            cursor: move;
            user-select: none;
        }
        
        .text-box:focus {
            border: 1px dashed #5e3b12;
            outline: none;
        }
        
        .image-container {
            position: absolute;
            cursor: move;
        }
        
        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #5e3b12;
            border-radius: 50%;
            display: none;
        }
        
        .resize-handle-se {
            bottom: -5px;
            right: -5px;
            cursor: se-resize;
        }
        
        .resize-handle-ne {
            top: -5px;
            right: -5px;
            cursor: ne-resize;
        }
        
        .resize-handle-sw {
            bottom: -5px;
            left: -5px;
            cursor: sw-resize;
        }
        
        .resize-handle-nw {
            top: -5px;
            left: -5px;
            cursor: nw-resize;
        }
        
        .element-selected .resize-handle {
            display: block;
        }
        
        .editor-toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .editor-toolbar button {
            background-color: white;
            border: 1px solid #5e3b12;
            color: #5e3b12;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .editor-toolbar button:hover {
            background-color: #e8d8c3;
        }
    </style>
</head>
<body>
    <div class="handbook-container">
        <!-- 左侧边栏 -->
        <aside class="sidebar">
            <h1>LifeMaster手账</h1>
            <ul class="menu">
                <li>所有文件</li>
                <li>旅行手账</li>
                <li>日常出游</li>
            </ul>
            <div class="sidebar-buttons">
                <button class="btn" id="new-folder-btn">新建文件夹</button>
                <button class="btn" id="new-file-btn">新建文件</button>
            </div>
        </aside>

        <!-- 右侧主内容区
        <main class="content">
            <div class="grid">
                <div class="card">
                    <div class="delete-btn">X</div>
                    <p>新建文件</p>
                </div>
            </div>
        </main>
    </div> -->
    
    <!-- 新建文件夹模态框 -->
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="new-folder-modal">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-primary">新建文件夹</h3>
                <button class="text-gray-500 hover:text-gray-700" id="close-folder-modal">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">文件夹名称</label>
                <input type="text" class="input-field w-full" id="folder-name-input" placeholder="输入文件夹名称">
            </div>
            <div class="flex justify-end space-x-3">
                <button class="btn-secondary" id="cancel-folder-btn">取消</button>
                <button class="btn-primary" id="confirm-folder-btn">创建</button>
            </div>
        </div>
    </div>
    
    <!-- 新建文件模态框 -->
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="new-file-modal">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-primary">新建手账</h3>
                <button class="text-gray-500 hover:text-gray-700" id="close-file-modal">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">手账标题</label>
                <input type="text" class="input-field w-full" id="file-title-input" placeholder="输入手账标题">
            </div>
            
            <!-- 编辑器工具栏 -->
            <div class="editor-toolbar">
                <button id="add-image-btn" title="插入图片">
                    <i class="fa fa-picture-o"></i>
                </button>
                <button id="add-sticker-btn" title="插入贴纸">
                    <i class="fa fa-smile-o"></i>
                </button>
                <button id="add-text-btn" title="插入文本框">
                    <i class="fa fa-font"></i>
                </button>
                <div class="ml-auto">
                    <select id="sticker-select" class="border border-gray-300 rounded-lg px-2 py-1">
                        <option value="">选择贴纸...</option>
                        <option value="heart">❤️</option>
                        <option value="star">⭐</option>
                        <option value="smile">😊</option>
                        <option value="flower">🌸</option>
                        <option value="sun">☀️</option>
                    </select>
                </div>
            </div>
            
            <!-- 手账编辑器 -->
            <div class="handbook-editor mb-4" id="handbook-editor">
                <!-- 这里是用户可以拖放内容的区域 -->
                <div class="text-center text-gray-400 mt-10">
                    <p>拖放图片、贴纸或文本框到这里</p>
                    <p class="text-sm mt-2">使用工具栏添加元素</p>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button class="btn-secondary" id="cancel-file-btn">取消</button>
                <button class="btn-primary" id="confirm-file-btn">保存手账</button>
            </div>
        </div>
    </div>
    
    <!-- 图片上传模态框 -->
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="image-upload-modal">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-primary">上传图片</h3>
                <button class="text-gray-500 hover:text-gray-700" id="close-image-modal">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">选择图片</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                    <input type="file" class="hidden" id="image-upload-input">
                    <button class="btn-primary" id="browse-image-btn">浏览文件</button>
                    <p class="text-sm text-gray-500 mt-2">支持JPG, PNG, GIF格式</p>
                    <div class="mt-4 hidden" id="image-preview-container">
                        <img src="" alt="预览图" class="max-w-full h-auto rounded-lg" id="image-preview">
                    </div>
                </div>
            </div>
            <div class="flex justify-end space-x-3">
                <button class="btn-secondary" id="cancel-image-btn">取消</button>
                <button class="btn-primary" id="confirm-image-btn" disabled>插入图片</button>
            </div>
        </div>
    </div>

    <script>
        // DOM元素
        const newFolderBtn = document.getElementById('new-folder-btn');
        const newFileBtn = document.getElementById('new-file-btn');
        const closeFolderModal = document.getElementById('close-folder-modal');
        const cancelFolderBtn = document.getElementById('cancel-folder-btn');
        const confirmFolderBtn = document.getElementById('confirm-folder-btn');
        const folderNameInput = document.getElementById('folder-name-input');
        const newFolderModal = document.getElementById('new-folder-modal');
        
        const closeFileModal = document.getElementById('close-file-modal');
        const cancelFileBtn = document.getElementById('cancel-file-btn');
        const confirmFileBtn = document.getElementById('confirm-file-btn');
        const fileTitleInput = document.getElementById('file-title-input');
        const newFileModal = document.getElementById('new-file-modal');
        
        const handbookEditor = document.getElementById('handbook-editor');
        const addImageBtn = document.getElementById('add-image-btn');
        const addStickerBtn = document.getElementById('add-sticker-btn');
        const addTextBtn = document.getElementById('add-text-btn');
        const stickerSelect = document.getElementById('sticker-select');
        
        const imageUploadModal = document.getElementById('image-upload-modal');
        const closeImageModal = document.getElementById('close-image-modal');
        const cancelImageBtn = document.getElementById('cancel-image-btn');
        const confirmImageBtn = document.getElementById('confirm-image-btn');
        const browseImageBtn = document.getElementById('browse-image-btn');
        const imageUploadInput = document.getElementById('image-upload-input');
        const imagePreview = document.getElementById('image-preview');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        
        // 当前选中的元素
        let selectedElement = null;
        let isDragging = false;
        let offsetX, offsetY;
        let currentAction = null; // 'resize' 或 'move'
        let resizeDirection = null; // 'se', 'ne', 'sw', 'nw'
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件处理函数
            bindEvents();
        });
        
        // 绑定所有事件处理函数
        function bindEvents() {
            // 侧边栏按钮事件
            newFolderBtn.addEventListener('click', openNewFolderModal);
            newFileBtn.addEventListener('click', openNewFileModal);
            
            // 文件夹模态框事件
            closeFolderModal.addEventListener('click', closeNewFolderModal);
            cancelFolderBtn.addEventListener('click', closeNewFolderModal);
            confirmFolderBtn.addEventListener('click', createNewFolder);
            
            // 文件模态框事件
            closeFileModal.addEventListener('click', closeNewFileModal);
            cancelFileBtn.addEventListener('click', closeNewFileModal);
            confirmFileBtn.addEventListener('click', createNewFile);
            
            // 编辑器工具栏事件
            addImageBtn.addEventListener('click', openImageUploadModal);
            addStickerBtn.addEventListener('click', addSticker);
            addTextBtn.addEventListener('click', addTextBox);
            stickerSelect.addEventListener('change', function() {
                if (this.value) {
                    addSticker(this.value);
                    this.value = '';
                }
            });
            
            // 图片上传模态框事件
            closeImageModal.addEventListener('click', closeImageUploadModal);
            cancelImageBtn.addEventListener('click', closeImageUploadModal);
            confirmImageBtn.addEventListener('click', insertImage);
            browseImageBtn.addEventListener('click', function() {
                imageUploadInput.click();
            });
            
            imageUploadInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        imagePreview.src = event.target.result;
                        imagePreviewContainer.classList.remove('hidden');
                        confirmImageBtn.disabled = false;
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            // 编辑器交互事件
            handbookEditor.addEventListener('mousedown', handleEditorMouseDown);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }
        
        // 打开新建文件夹模态框
        function openNewFolderModal() {
            newFolderModal.classList.remove('hidden');
            folderNameInput.focus();
        }
        
        // 关闭新建文件夹模态框
        function closeNewFolderModal() {
            newFolderModal.classList.add('hidden');
            folderNameInput.value = '';
        }
        
        // 获取菜单列表元素
        const menuList = document.querySelector('.menu');

        // 创建新文件夹
        function createNewFolder() {
            const folderName = folderNameInput.value.trim();
            if (folderName) {
                // 新增：在左侧菜单栏添加新文件夹
                const li = document.createElement('li');
                li.textContent = folderName;
                li.style.fontSize = '1.2rem';
                li.style.color = '#5e3b12';
                li.style.padding = '0.5rem 0';
                li.style.textAlign = 'center';
                li.style.cursor = 'pointer';
                li.addEventListener('mouseenter', () => li.style.backgroundColor = '#e8d8c3');
                li.addEventListener('mouseleave', () => li.style.backgroundColor = '');
                menuList.appendChild(li);

                closeNewFolderModal();
            } else {
                alert('请输入文件夹名称');
            }
        }
        
        // 打开新建文件模态框
        function openNewFileModal() {
            newFileModal.classList.remove('hidden');
            fileTitleInput.focus();
            // 清空编辑器
            handbookEditor.innerHTML = `
                <div class="text-center text-gray-400 mt-10">
                    <p>拖放图片、贴纸或文本框到这里</p>
                    <p class="text-sm mt-2">使用工具栏添加元素</p>
                </div>
            `;
        }
        
        // 关闭新建文件模态框
        function closeNewFileModal() {
            newFileModal.classList.add('hidden');
            fileTitleInput.value = '';
        }
        
        // 打开图片上传模态框
        function openImageUploadModal() {
            imageUploadModal.classList.remove('hidden');
            imageUploadInput.value = '';
            imagePreviewContainer.classList.add('hidden');
            confirmImageBtn.disabled = true;
        }
        
        // 关闭图片上传模态框
        function closeImageUploadModal() {
            imageUploadModal.classList.add('hidden');
        }
        
        // 插入图片到编辑器
        function insertImage() {
            if (imagePreview.src) {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'image-container';
                imgContainer.style.position = 'absolute';
                imgContainer.style.top = '50px';
                imgContainer.style.left = '50px';
                
                const img = document.createElement('img');
                img.src = imagePreview.src;
                img.style.maxWidth = '200px';
                img.style.height = 'auto';
                
                // 添加调整大小手柄
                const resizeSE = document.createElement('div');
                resizeSE.className = 'resize-handle resize-handle-se';
                
                const resizeNE = document.createElement('div');
                resizeNE.className = 'resize-handle resize-handle-ne';
                
                const resizeSW = document.createElement('div');
                resizeSW.className = 'resize-handle resize-handle-sw';
                
                const resizeNW = document.createElement('div');
                resizeNW.className = 'resize-handle resize-handle-nw';
                
                imgContainer.appendChild(img);
                imgContainer.appendChild(resizeSE);
                imgContainer.appendChild(resizeNE);
                imgContainer.appendChild(resizeSW);
                imgContainer.appendChild(resizeNW);
                
                // 清空编辑器提示文本
                if (handbookEditor.querySelector('.text-center')) {
                    handbookEditor.innerHTML = '';
                }
                
                handbookEditor.appendChild(imgContainer);
                
                // 绑定事件
                bindElementEvents(imgContainer);
                
                closeImageUploadModal();
            }
        }
        
        // 添加贴纸
        function addSticker(stickerType = 'heart') {
            const stickers = {
                heart: '❤️',
                star: '⭐',
                smile: '😊',
                flower: '🌸',
                sun: '☀️'
            };
            
            const sticker = document.createElement('div');
            sticker.className = 'sticker';
            sticker.style.position = 'absolute';
            sticker.style.top = '50px';
            sticker.style.left = '50px';
            sticker.style.fontSize = '2rem';
            sticker.textContent = stickers[stickerType] || stickers.heart;
            
            // 添加调整大小手柄
            const resizeSE = document.createElement('div');
            resizeSE.className = 'resize-handle resize-handle-se';
            
            sticker.appendChild(resizeSE);
            
            // 清空编辑器提示文本
            if (handbookEditor.querySelector('.text-center')) {
                handbookEditor.innerHTML = '';
            }
            
            handbookEditor.appendChild(sticker);
            
            // 绑定事件
            bindElementEvents(sticker);
        }
        
        // 添加文本框
        function addTextBox() {
            const textBox = document.createElement('div');
            textBox.className = 'text-box';
            textBox.style.position = 'absolute';
            textBox.style.top = '50px';
            textBox.style.left = '50px';
            textBox.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
            textBox.style.borderRadius = '5px';
            textBox.style.padding = '0.5rem';
            textBox.style.minWidth = '150px';
            textBox.setAttribute('contenteditable', 'true');
            textBox.textContent = '输入文本...';
            
            // 添加调整大小手柄
            const resizeSE = document.createElement('div');
            resizeSE.className = 'resize-handle resize-handle-se';
            
            textBox.appendChild(resizeSE);
            
            // 清空编辑器提示文本
            if (handbookEditor.querySelector('.text-center')) {
                handbookEditor.innerHTML = '';
            }
            
            handbookEditor.appendChild(textBox);
            
            // 绑定事件
            bindElementEvents(textBox);
            
            // 自动聚焦
            textBox.focus();
        }
        
        // 绑定元素事件
        function bindElementEvents(element) {
            element.addEventListener('mousedown', function(e) {
                // 如果点击的是调整大小手柄
                if (e.target.classList.contains('resize-handle')) {
                    currentAction = 'resize';
                    
                    if (e.target.classList.contains('resize-handle-se')) {
                        resizeDirection = 'se';
                    } else if (e.target.classList.contains('resize-handle-ne')) {
                        resizeDirection = 'ne';
                    } else if (e.target.classList.contains('resize-handle-sw')) {
                        resizeDirection = 'sw';
                    } else if (e.target.classList.contains('resize-handle-nw')) {
                        resizeDirection = 'nw';
                    }
                    
                    selectedElement = element;
                    isDragging = true;
                    
                    // 防止选中其他文本
                    e.preventDefault();
                } 
                // 如果点击的是元素本身
                else if (e.target === element || element.contains(e.target)) {
                    // 取消之前选中的元素
                    if (selectedElement) {
                        selectedElement.classList.remove('element-selected');
                    }
                    
                    // 设置当前选中元素
                    selectedElement = element;
                    element.classList.add('element-selected');
                    
                    // 计算鼠标相对元素的偏移量
                    const rect = element.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                    
                    currentAction = 'move';
                    isDragging = true;
                    
                    // 防止选中其他文本
                    e.preventDefault();
                }
            });
        }
        
        // 处理编辑器鼠标按下事件
        function handleEditorMouseDown(e) {
            // 如果点击的是编辑器空白处，取消选中
            if (e.target === handbookEditor) {
                if (selectedElement) {
                    selectedElement.classList.remove('element-selected');
                    selectedElement = null;
                }
            }
        }
        
        // 处理鼠标移动事件
        function handleMouseMove(e) {
            if (!isDragging) return;
            
            if (currentAction === 'move' && selectedElement) {
                // 移动元素
                const editorRect = handbookEditor.getBoundingClientRect();
                const newX = e.clientX - editorRect.left - offsetX;
                const newY = e.clientY - editorRect.top - offsetY;
                
                // 确保元素不超出编辑器边界
                const elementWidth = selectedElement.offsetWidth;
                const elementHeight = selectedElement.offsetHeight;
                
                const maxX = editorRect.width - elementWidth;
                const maxY = editorRect.height - elementHeight;
                
                selectedElement.style.left = Math.max(0, Math.min(newX, maxX)) + 'px';
                selectedElement.style.top = Math.max(0, Math.min(newY, maxY)) + 'px';
            } 
            else if (currentAction === 'resize' && selectedElement) {
                // 调整元素大小
                const editorRect = handbookEditor.getBoundingClientRect();
                const elementRect = selectedElement.getBoundingClientRect();
                
                let newWidth, newHeight;
                
                if (resizeDirection === 'se') {
                    newWidth = e.clientX - elementRect.left;
                    newHeight = e.clientY - elementRect.top;
                } else if (resizeDirection === 'ne') {
                    newWidth = e.clientX - elementRect.left;
                    newHeight = elementRect.top + elementRect.height - e.clientY;
                    selectedElement.style.top = e.clientY - editorRect.top + 'px';
                } else if (resizeDirection === 'sw') {
                    newWidth = elementRect.right - e.clientX;
                    newHeight = e.clientY - elementRect.top;
                    selectedElement.style.left = e.clientX - editorRect.left + 'px';
                } else if (resizeDirection === 'nw') {
                    newWidth = elementRect.right - e.clientX;
                    newHeight = elementRect.top + elementRect.height - e.clientY;
                    selectedElement.style.left = e.clientX - editorRect.left + 'px';
                    selectedElement.style.top = e.clientY - editorRect.top + 'px';
                }
                
                // 确保最小尺寸
                newWidth = Math.max(50, newWidth);
                newHeight = Math.max(50, newHeight);
                
                // 确保不超出编辑器边界
                if (elementRect.left + newWidth <= editorRect.width) {
                    if (selectedElement.tagName === 'IMG') {
                        selectedElement.style.width = newWidth + 'px';
                    } else {
                        selectedElement.style.width = newWidth + 'px';
                    }
                }
                
                if (elementRect.top + newHeight <= editorRect.height) {
                    if (selectedElement.classList.contains('sticker')) {
                        // 对于贴纸，调整字体大小
                        const fontSize = Math.max(12, newHeight / 2);
                        selectedElement.style.fontSize = fontSize + 'px';
                    } else if (selectedElement.tagName === 'IMG') {
                        // 对于图片，保持比例
                        const img = selectedElement.querySelector('img');
                        if (img) {
                            img.style.width = newWidth + 'px';
                            img.style.height = 'auto';
                        }
                    } else {
                        selectedElement.style.height = newHeight + 'px';
                    }
                }
            }
        }
        
        // 处理鼠标释放事件
        function handleMouseUp() {
            isDragging = false;
            currentAction = null;
            resizeDirection = null;
        }
        
        // 创建新手账文件
        function createNewFile() {
            const title = fileTitleInput.value.trim();
            
            if (title) {
                // 获取编辑器内容
                const elements = handbookEditor.querySelectorAll('.image-container, .sticker, .text-box');
                const content = [];
                
                elements.forEach(element => {
                    const elementData = {
                        type: element.classList.contains('image-container') ? 'image' : 
                              element.classList.contains('sticker') ? 'sticker' : 'text',
                        top: element.style.top,
                        left: element.style.left,
                        width: element.style.width || element.offsetWidth + 'px',
                        height: element.style.height || element.offsetHeight + 'px'
                    };
                    
                    if (elementData.type === 'image') {
                        const img = element.querySelector('img');
                        elementData.src = img.src;
                    } else if (elementData.type === 'sticker') {
                        elementData.content = element.textContent;
                    } else if (elementData.type === 'text') {
                        elementData.content = element.textContent;
                    }
                    
                    content.push(elementData);
                });
                
                // 这里可以添加保存手账的逻辑
                console.log('保存手账:', { title, content });
                alert(`手账 "${title}" 已保存`);
                
                closeNewFileModal();
            } else {
                alert('请输入手账标题');
            }
        }
    </script>
</body>
</html>